import{t as O,a as y,b as T}from"../chunks/CaasTpf9.js";import{i as W}from"../chunks/OKV8WO5A.js";import{e as E,f as G,i as f,t as V,g as n,m as H,s as v,k as c,r as p,n as P}from"../chunks/EW6ToMZV.js";import{e as J,s as K}from"../chunks/C-8pGi1S.js";import{r as N}from"../chunks/BduPwU6f.js";import{F as Q,A as X,C as Y,P as Z,a as ee,_ as te}from"../chunks/FiiLKZqd.js";import{P as oe,s as ae}from"../chunks/BIL20m6r.js";import{P as re}from"../chunks/BJzTzqsX.js";var k=N(()=>te),se=O('<main class="flex flex-col justify-center items-center pt-5"><div class="w-1/2"><!></div> <div class="w-1/2 mt-12 flex flex-col gap-12"><button id="ocr_btn" type="button" class=" w-full btn preset-filled-primary-500" disabled>Perform OCR on PDF</button> <!> <a id="file_downloader" class="btn preset-filled-success-500 hidden">Download pdf</a></div> <a href="/" class="btn preset-filled-surface-500 rounded-full h-12 w-12 fixed top-5 left-5"><!></a></main>');function me($,A){E(A,!1);let D="https://unpkg.com/pdfjs-dist@5.0.375/build/pdf.worker.min.mjs",l,R,s=H(0),b;async function S(t){k(k().workerSrc=D);const a=new FileReader;return a.readAsArrayBuffer(t),new Promise(o=>{a.onload=async()=>{const e=a.result,r=await pdfjsLib.getDocument({data:e}).promise;let i=[];for(let w=1;w<=r.numPages;w++){const F=await r.getPage(w),_=F.getViewport({scale:2}),d=document.createElement("canvas"),M=d.getContext("2d");d.width=_.width,d.height=_.height,await F.render({canvasContext:M,viewport:_}).promise,i.push(d.toDataURL("image/png"))}o(i)}})}async function j(t,a,o){console.log(t);try{const e=await ae.createWorker("eng",1,{logger:i=>{console.log(i),i.status=""}}),{data:r}=await e.recognize(t,{pdfTitle:`part_${a}`},{pdf:!0});return console.log(r.text),R=r.pdf,e.terminate(),c(s,n(s)+1/o*100),c(s,n(s)>100?100:Math.floor(n(s))),Promise.resolve({pdf_raw:r.pdf,index:a})}catch(e){return console.error(e),Promise.reject(e)}}function z(t,a){const o=new Blob([new Uint8Array(t)],{type:"application/pdf"});return o.name=a,o.lastModifiedData=new Date,o}async function C(t){const a=new re;console.log(t),t.map(r=>{r.pdf_file=z(r.pdf,`${r.index}.pdf`)});for(let r=0;r<t.length;r++)await a.add(t[r].pdf_raw);await a.setMetadata({title:`${l[0].name.split(".")[0]}`});let o=await a.saveAsBlob();console.log("error not above");const e=document.querySelector("#file_downloader");if(e.download!==void 0){const r=URL.createObjectURL(o);e.setAttribute("href",r),e.setAttribute("download",l[0].name.split(".")[0])}}async function L(){l=[],l[0]=b,console.log(l),c(s,null);let t=await S(l[0]);console.log(t);let a=[];for(let o=0;o<t.length;o++)await j(t[o],o,t.length).then(e=>{a.push(e)});a.sort((o,e)=>o.index-e.index),await C(a),document.querySelector("#file_downloader").classList.remove("hidden"),c(s,n(s)<100?100:n(s)),console.log(a)}function q(t){t.acceptedFiles.length>0?document.querySelector("#ocr_btn").disabled=!1:document.querySelector("#ocr_btn").disabled=!0,document.querySelector("#file_downloader").classList.add("hidden"),c(s,0),b=t.acceptedFiles[0]}W();var u=se(),m=f(u),U=f(m);Q(U,{accept:"application/pdf",maxFiles:1,subtext:"Attach single PDF.",onFileChange:e=>{q(e)},classes:"w-full",iconInterface:e=>{ee(e,{class:"size-8"})},iconFile:e=>{Z(e,{class:"size-4"})},iconFileRemove:e=>{Y(e,{class:"size-4"})},$$slots:{iconInterface:!0,iconFile:!0,iconFileRemove:!0}}),p(m);var g=v(m,2),h=f(g),B=v(h,2);oe(B,{get value(){return n(s)},max:100,children:(t,a)=>{P();var o=T();V(()=>K(o,n(s)!=null?n(s)+"%":"loading...")),y(t,o)},$$slots:{default:!0}}),P(2),p(g);var x=v(g,2),I=f(x);X(I,{class:"size-8"}),p(x),p(u),J("click",h,()=>{L()}),y($,u),G()}export{me as component};
