import"../chunks/CWj6FrbW.js";import{i as V}from"../chunks/WWVtWIcG.js";import{e as H,g as n,f as K,j as _,s as b,t as N,m as k,k as c,r as w,n as $}from"../chunks/4Vjq8Xjj.js";import{t as Q,e as z,a as D,b as X,s as Y}from"../chunks/B4dHhGZh.js";import{p as ee,r as te}from"../chunks/yOqKe9X7.js";import{b as oe}from"../chunks/fZsvpuVm.js";import{r as ae}from"../chunks/B0CBmk3k.js";import"../chunks/CCLTtN7-.js";import{F as le,C as se,P as re,a as ne,_ as ie}from"../chunks/BjFtRYDz.js";import{P as ce,s as pe}from"../chunks/Cg-cZ5-n.js";import{P as de}from"../chunks/BI09sTSY.js";import{J as fe}from"../chunks/FGvmAy_r.js";var q=ae(()=>ie),ue=Q('<main class="flex flex-col justify-center items-center pt-5"><div class="w-1/2"><!></div> <div class="w-1/2 mt-12 flex flex-col gap-12"><label class="label"><span class="label-text">Pages to Extract</span> <input class="input" type="text" placeholder="Example: 1, 5-8"></label> <button id="ocr_btn" type="button" class=" w-full btn preset-filled-primary-500" disabled>Split PDFs</button> <!> <a id="file_downloader" class="btn preset-filled-success-500 hidden">Download Pdfs</a></div></main>');function ke(A,j){H(j,!1),ee.set("Split PDFs");let L="https://unpkg.com/pdfjs-dist@5.0.375/build/pdf.worker.min.mjs",F=new fe,g,R,r=k(0),u,m=k();async function E(e){const t=F.folder("images_folder");console.log(e),e.forEach(a=>{t.file(a.name+".pdf",a)}),console.log(t);let o=await t.generateAsync({type:"blob"});return F.remove("images_folder"),o}async function C(e){q(q().workerSrc=L);const t=new FileReader;return t.readAsArrayBuffer(e),new Promise(o=>{t.onload=async()=>{const a=t.result,l=await pdfjsLib.getDocument({data:a}).promise;let s=[];for(let d=1;d<=l.numPages;d++){const f=await l.getPage(d),i=f.getViewport({scale:2}),p=document.createElement("canvas"),Z=p.getContext("2d");p.width=i.width,p.height=i.height,await f.render({canvasContext:Z,viewport:i}).promise,s.push(p.toDataURL("image/png"))}o(s)}})}async function I(e,t,o){console.log(e);try{const a=await pe.createWorker("eng",1,{logger:s=>{console.log(s),s.status=""}}),{data:l}=await a.recognize(e,{pdfTitle:`part_${t}`},{pdf:!0});return console.log(l.text),R=l.pdf,a.terminate(),Promise.resolve({pdf_raw:l.pdf,index:t})}catch(a){return console.error(a),Promise.reject(a)}}function U(e,t){const o=new Blob([new Uint8Array(e)],{type:"application/pdf"});return o.name=t,o.lastModifiedData=new Date,o}async function B(e,t){const o=new de;console.log(e),e.map(l=>{l.pdf_file=U(l.pdf,`${l.index}.pdf`)});for(let l=0;l<e.length;l++)await o.add(e[l].pdf_raw);await o.setMetadata({title:`${t}`});let a=await o.saveAsBlob();return console.log("error not above"),new File([a],t)}async function M(){g=[],g[0]=u,console.log(g),c(r,null);let e=await C(g[0]);console.log(e);let t=W(e,n(m));console.log(t);let o=[];c(r,0);for(let s=0;s<t.length;s++){console.log(t[s]);let d=[],f=t[s];for(let i=0;i<f.length;i++)await I(f[i],i,f.length).then(p=>{d.push(p)});d.sort((i,p)=>i.index-p.index),o.push(await B(d,u.name.split(".")[0]+"_split_"+s)),c(r,n(r)+1/t.length*100),c(r,n(r)>100?100:Math.floor(n(r)))}console.log(o);let a=await E(o);const l=document.querySelector("#file_downloader");if(l.download!==void 0){const s=URL.createObjectURL(a);l.setAttribute("href",s),l.setAttribute("download",u.name.split(".")[0])}document.querySelector("#file_downloader").classList.remove("hidden"),c(r,n(r)<100?100:n(r))}function O(e){e.acceptedFiles.length>0&&n(m)?document.querySelector("#ocr_btn").disabled=!1:document.querySelector("#ocr_btn").disabled=!0,document.querySelector("#file_downloader").classList.add("hidden"),c(r,0),u=e.acceptedFiles[0]}function T(e){console.log(),u&&e.target.value?document.querySelector("#ocr_btn").disabled=!1:document.querySelector("#ocr_btn").disabled=!0,document.querySelector("#file_downloader").classList.add("hidden"),c(r,0),c(m,e.target.value)}function W(e,t){let o=[];return t.split(",").forEach(l=>{let s=l.split("-");s.length>1?o.push(e.slice(s[0]-1,s[1])):o.push(e.slice(s[0]-1,s[0]))}),o}V();var v=ue(),h=_(v),G=_(h);le(G,{accept:"application/pdf",maxFiles:1,subtext:"Attach single PDF.",onFileChange:a=>{O(a)},classes:"w-full",iconInterface:a=>{ne(a,{class:"size-8"})},iconFile:a=>{re(a,{class:"size-4"})},iconFileRemove:a=>{se(a,{class:"size-4"})},$$slots:{iconInterface:!0,iconFile:!0,iconFileRemove:!0}}),w(h);var P=b(h,2),x=_(P),y=b(_(x),2);te(y),w(x);var S=b(x,2),J=b(S,2);ce(J,{get value(){return n(r)},max:100,children:(e,t)=>{$();var o=X();N(()=>Y(o,n(r)!=null?n(r)+"%":"loading...")),D(e,o)},$$slots:{default:!0}}),$(2),w(P),w(v),z("input",y,e=>{T(e)}),oe(y,()=>n(m),e=>c(m,e)),z("click",S,()=>{M()}),D(A,v),K()}export{ke as component};
