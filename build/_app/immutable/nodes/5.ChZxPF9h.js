import"../chunks/CWj6FrbW.js";import{i as B}from"../chunks/WWVtWIcG.js";import{e as I,f as M,j as g,t as T,g as s,m as W,s as x,k as c,r as w,n as F}from"../chunks/4Vjq8Xjj.js";import{t as E,e as G,a as P,b as V,s as H}from"../chunks/B4dHhGZh.js";import{r as J}from"../chunks/B0CBmk3k.js";import"../chunks/CCLTtN7-.js";import{F as K,C as N,P as Q,a as X,_ as Y}from"../chunks/BjFtRYDz.js";import{P as Z,s as ee}from"../chunks/Cg-cZ5-n.js";import{P as te}from"../chunks/BI09sTSY.js";import{p as oe}from"../chunks/yOqKe9X7.js";var y=J(()=>Y),ae=E('<main class="flex flex-col justify-center items-center pt-5"><div class="w-1/2"><!></div> <div class="w-1/2 mt-12 flex flex-col gap-12"><button id="ocr_btn" type="button" class=" w-full btn preset-filled-primary-500" disabled>Perform OCR on PDF</button> <!> <a id="file_downloader" class="btn preset-filled-success-500 hidden">Download pdf</a></div></main>');function ue(k,$){I($,!1),oe.set("PDF OCR");let D="https://unpkg.com/pdfjs-dist@5.0.375/build/pdf.worker.min.mjs",i,R,n=W(0),_;async function j(t){y(y().workerSrc=D);const a=new FileReader;return a.readAsArrayBuffer(t),new Promise(o=>{a.onload=async()=>{const e=a.result,r=await pdfjsLib.getDocument({data:e}).promise;let l=[];for(let m=1;m<=r.numPages;m++){const h=await r.getPage(m),u=h.getViewport({scale:2}),d=document.createElement("canvas"),U=d.getContext("2d");d.width=u.width,d.height=u.height,await h.render({canvasContext:U,viewport:u}).promise,l.push(d.toDataURL("image/png"))}o(l)}})}async function A(t,a,o){console.log(t);try{const e=await ee.createWorker("eng",1,{logger:l=>{console.log(l),l.status=""}}),{data:r}=await e.recognize(t,{pdfTitle:`part_${a}`},{pdf:!0});return console.log(r.text),R=r.pdf,e.terminate(),c(n,s(n)+1/o*100),c(n,s(n)>100?100:Math.floor(s(n))),Promise.resolve({pdf_raw:r.pdf,index:a})}catch(e){return console.error(e),Promise.reject(e)}}function C(t,a){const o=new Blob([new Uint8Array(t)],{type:"application/pdf"});return o.name=a,o.lastModifiedData=new Date,o}async function S(t){const a=new te;console.log(t),t.map(r=>{r.pdf_file=C(r.pdf,`${r.index}.pdf`)});for(let r=0;r<t.length;r++)await a.add(t[r].pdf_raw);await a.setMetadata({title:`${i[0].name.split(".")[0]}`});let o=await a.saveAsBlob();console.log("error not above");const e=document.querySelector("#file_downloader");if(e.download!==void 0){const r=URL.createObjectURL(o);e.setAttribute("href",r),e.setAttribute("download",i[0].name.split(".")[0])}}async function L(){i=[],i[0]=_,console.log(i),c(n,null);let t=await j(i[0]);console.log(t);let a=[];for(let o=0;o<t.length;o++)await A(t[o],o,t.length).then(e=>{a.push(e)});a.sort((o,e)=>o.index-e.index),await S(a),document.querySelector("#file_downloader").classList.remove("hidden"),c(n,s(n)<100?100:s(n)),console.log(a)}function q(t){t.acceptedFiles.length>0?document.querySelector("#ocr_btn").disabled=!1:document.querySelector("#ocr_btn").disabled=!0,document.querySelector("#file_downloader").classList.add("hidden"),c(n,0),_=t.acceptedFiles[0]}B();var p=ae(),f=g(p),z=g(f);K(z,{accept:"application/pdf",maxFiles:1,subtext:"Attach single PDF.",onFileChange:e=>{q(e)},classes:"w-full",iconInterface:e=>{X(e,{class:"size-8"})},iconFile:e=>{Q(e,{class:"size-4"})},iconFileRemove:e=>{N(e,{class:"size-4"})},$$slots:{iconInterface:!0,iconFile:!0,iconFileRemove:!0}}),w(f);var b=x(f,2),v=g(b),O=x(v,2);Z(O,{get value(){return s(n)},max:100,children:(t,a)=>{F();var o=V();T(()=>H(o,s(n)!=null?s(n)+"%":"loading...")),P(t,o)},$$slots:{default:!0}}),F(2),w(b),w(p),G("click",v,()=>{L()}),P(k,p),M()}export{ue as component};
